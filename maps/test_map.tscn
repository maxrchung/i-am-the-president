[gd_scene load_steps=18 format=3 uid="uid://bboibipxo6flu"]

[ext_resource type="Script" path="res://maps/test_map.gd" id="1_0a3d1"]
[ext_resource type="PackedScene" uid="uid://c7k5ww22arkk2" path="res://gameobjects/bicycle.tscn" id="1_edykj"]
[ext_resource type="Shader" path="res://shaders/postprocess.gdshader" id="3_a57eh"]
[ext_resource type="Texture2D" uid="uid://djytkt442qiqt" path="res://icon.svg" id="4_8if12"]
[ext_resource type="Script" path="res://maps/minimap.gd" id="5_ey4rv"]
[ext_resource type="PackedScene" uid="uid://cy54or8degxgl" path="res://assets/models/track_dev.glb" id="6_pcrmm"]
[ext_resource type="Texture2D" uid="uid://cdqnmaxdommg5" path="res://assets/skybox/whipple_creek_regional_park_04_4k.exr" id="7_4ydi2"]

[sub_resource type="ParticleProcessMaterial" id="ParticleProcessMaterial_sw86o"]
emission_shape_offset = Vector3(0, 8, 0)
emission_shape = 3
emission_box_extents = Vector3(32, 0, 64)
direction = Vector3(0, -1, 0)
initial_velocity_min = 32.0
initial_velocity_max = 32.0

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_2c04q"]
transparency = 3
alpha_hash_scale = 1.0
alpha_antialiasing_mode = 0
albedo_color = Color(0.619608, 0.254902, 0.552941, 0.603922)

[sub_resource type="SphereMesh" id="SphereMesh_qccq2"]
material = SubResource("StandardMaterial3D_2c04q")
radius = 0.04
height = 0.04
radial_segments = 8
rings = 2

[sub_resource type="QuadMesh" id="QuadMesh_rxd2c"]
flip_faces = true
size = Vector2(2, 2)

[sub_resource type="ShaderMaterial" id="ShaderMaterial_1vtw1"]
render_priority = 0
shader = ExtResource("3_a57eh")
shader_parameter/edge_only = true
shader_parameter/edge_threshold = 1.0
shader_parameter/line_color = Color(1, 1, 1, 1)
shader_parameter/background_color = Color(1, 1, 1, 1)

[sub_resource type="BoxShape3D" id="BoxShape3D_eigu5"]
size = Vector3(33.6801, 41.8364, 1)

[sub_resource type="ViewportTexture" id="ViewportTexture_0pe7u"]

[sub_resource type="PanoramaSkyMaterial" id="PanoramaSkyMaterial_a0xp4"]
panorama = ExtResource("7_4ydi2")

[sub_resource type="Sky" id="Sky_kgvh6"]
sky_material = SubResource("PanoramaSkyMaterial_a0xp4")

[sub_resource type="Environment" id="Environment_xjsex"]
background_mode = 2
background_energy_multiplier = 0.1
sky = SubResource("Sky_kgvh6")

[node name="TestMap" type="Node3D"]
script = ExtResource("1_0a3d1")

[node name="Bicycle" parent="." instance=ExtResource("1_edykj")]
transform = Transform3D(-1, 0, -8.74228e-08, 0, 1, 0, 8.74228e-08, 0, -1, 46.6844, 1.26458, 42.8507)

[node name="Camera3D" type="Camera3D" parent="Bicycle"]
transform = Transform3D(-1, 8.6572e-08, -1.21669e-08, 0, 0.139173, 0.990268, 8.74228e-08, 0.990268, -0.139173, 0, 12.45, -1)

[node name="Rain" type="GPUParticles3D" parent="Bicycle/Camera3D"]
transform = Transform3D(1, 0, 0, 0, 0.173648, -0.984808, 0, 0.984808, 0.173648, 0, 48, 0)
layers = 2
extra_cull_margin = 16384.0
ignore_occlusion_culling = true
amount = 50000
lifetime = 2.0
preprocess = 3.0
fixed_fps = 15
process_material = SubResource("ParticleProcessMaterial_sw86o")
draw_pass_1 = SubResource("SphereMesh_qccq2")

[node name="MeshInstance3D" type="MeshInstance3D" parent="Bicycle/Camera3D"]
transform = Transform3D(1, 0, 0, 0, -4.37114e-08, -1, 0, 1, -4.37114e-08, 0, 0, 0)
cast_shadow = 0
extra_cull_margin = 16384.0
ignore_occlusion_culling = true
mesh = SubResource("QuadMesh_rxd2c")
skeleton = NodePath("../..")
surface_material_override/0 = SubResource("ShaderMaterial_1vtw1")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 0.92325, 0.384199, 0, -0.384199, 0.92325, 0, 33.8125, 0)

[node name="WinUi" type="CanvasLayer" parent="."]
visible = false

[node name="YouWonText" type="Label" parent="WinUi"]
offset_left = 321.0
offset_top = 160.0
offset_right = 492.0
offset_bottom = 183.0
text = "Hey you won congrats"

[node name="PlayAgainButton" type="Button" parent="WinUi"]
visible = false
offset_left = 320.0
offset_top = 229.0
offset_right = 407.0
offset_bottom = 260.0
text = "Play again"

[node name="LeaveButton" type="Button" parent="WinUi"]
offset_left = 462.0
offset_top = 246.0
offset_right = 515.0
offset_bottom = 277.0
text = "Leave"

[node name="LoseUi" type="CanvasLayer" parent="."]
visible = false

[node name="YouWonText" type="Label" parent="LoseUi"]
offset_left = 431.0
offset_top = 309.0
offset_right = 602.0
offset_bottom = 332.0
text = "Lol you lost"

[node name="TryAgainButton" type="Button" parent="LoseUi"]
visible = false
offset_left = 417.0
offset_top = 376.0
offset_right = 504.0
offset_bottom = 407.0
text = "Try again"

[node name="LeaveButton" type="Button" parent="LoseUi"]
offset_left = 551.0
offset_top = 391.0
offset_right = 604.0
offset_bottom = 422.0
text = "Leave"

[node name="StartPosition" type="Node3D" parent="."]
transform = Transform3D(-1, 0, 8.74228e-08, 0, 1, 0, -8.74228e-08, 0, -1, 46.684, 1.265, 42.851)

[node name="EndArea" type="Area3D" parent="."]
transform = Transform3D(-0.175298, 0, -0.984515, 0, 1, 0, 0.984515, 0, -0.175298, 78.2538, 1.265, -51.6823)

[node name="EndIndicator" type="Sprite3D" parent="EndArea"]
transform = Transform3D(25.08, 0, 0, 0, 25.08, 0, 0, 0, 25.08, 0.803822, 0, 38.6651)
texture = ExtResource("4_8if12")

[node name="EndCollision" type="CollisionShape3D" parent="EndArea"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 1.46827, -2.81274, 38.5781)
shape = SubResource("BoxShape3D_eigu5")
disabled = true

[node name="Hud" type="CanvasLayer" parent="."]

[node name="SpeedLabel" type="Label" parent="Hud"]
offset_left = 30.0
offset_top = 49.0
offset_right = 82.0
offset_bottom = 72.0
text = "Speed:"

[node name="SpeedText" type="Label" parent="Hud"]
offset_left = 98.0
offset_top = 50.0
offset_right = 138.0
offset_bottom = 73.0
text = "0"

[node name="TimeLabel" type="Label" parent="Hud"]
offset_left = 133.0
offset_top = 14.0
offset_right = 176.0
offset_bottom = 37.0
text = "Time:"

[node name="TimeText" type="Label" parent="Hud"]
offset_left = 189.0
offset_top = 17.0
offset_right = 229.0
offset_bottom = 40.0
text = "0"

[node name="StartLabel" type="Label" parent="Hud"]
visible = false
offset_left = 497.0
offset_top = 249.0
offset_right = 537.0
offset_bottom = 272.0
text = "3"

[node name="FinishLabel" type="Label" parent="Hud"]
visible = false
offset_left = 516.0
offset_top = 280.0
offset_right = 568.0
offset_bottom = 303.0
text = "FINISH!"

[node name="StartTimer" type="Timer" parent="."]
wait_time = 3.999
one_shot = true

[node name="FinishTimer" type="Timer" parent="."]
wait_time = 3.999
one_shot = true

[node name="TextureRect" type="TextureRect" parent="."]
offset_left = 23.0
offset_top = 431.0
offset_right = 223.0
offset_bottom = 631.0
texture = SubResource("ViewportTexture_0pe7u")

[node name="SubViewportContainer" type="SubViewportContainer" parent="TextureRect"]
layout_mode = 0
offset_right = 200.0
offset_bottom = 200.0

[node name="SubViewport" type="SubViewport" parent="TextureRect/SubViewportContainer"]
transparent_bg = true
handle_input_locally = false
size = Vector2i(200, 200)
render_target_update_mode = 4

[node name="Camera3D" type="Camera3D" parent="TextureRect/SubViewportContainer/SubViewport"]
transform = Transform3D(-1, 8.74228e-08, 0, 3.82137e-15, 4.37114e-08, 1, 8.74228e-08, 1, -4.37114e-08, 46.684, 12.45, 42.851)
cull_mask = 1048573
projection = 1
script = ExtResource("5_ey4rv")
follow_scan_radius = 100.0
player_target = NodePath("../../../../Bicycle")
player_rotation_target = NodePath("../../../../Bicycle")

[node name="track_dev" parent="." instance=ExtResource("6_pcrmm")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -19.0864)

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_xjsex")

[connection signal="pressed" from="WinUi/PlayAgainButton" to="." method="_on_play_again_button_pressed"]
[connection signal="pressed" from="WinUi/LeaveButton" to="." method="_on_leave_button_pressed"]
[connection signal="pressed" from="LoseUi/TryAgainButton" to="." method="_on_try_again_button_pressed"]
[connection signal="pressed" from="LoseUi/LeaveButton" to="." method="_on_leave_button_pressed"]
[connection signal="body_entered" from="EndArea" to="." method="_on_end_area_body_entered"]
[connection signal="timeout" from="StartTimer" to="." method="_on_start_timer_timeout"]
[connection signal="timeout" from="FinishTimer" to="." method="_on_finish_timer_timeout"]
